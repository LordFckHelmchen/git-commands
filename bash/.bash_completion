#!/bin/bash

BASH_COMPLETION_FOLDER="$HOME/.bash_completion.d"

# Add completions for a command
# First input: name of the command
# Second input: command to add the completions
function add_completion() {
    local cmd=$1
    local completion_cmd=$2
    
    if [ -x "$(command -v $cmd)" ]; then
        echo "INFO:.bash_completion: Add completions for '$cmd'"
        eval "$completion_cmd" > "$BASH_COMPLETION_FOLDER/$cmd.bash-completion"
    fi
}

# Add bash completions for known binaries
add_completion "poetry" "poetry completions bash"
add_completion "pip" "pip completion --bash"
add_completion "pipx" "register-python-argcomplete pipx"
add_completion "uv" "uv generate-shell-completion bash"

# Source bash completions
for file in $BASH_COMPLETION_FOLDER/*; do
    if [ -f "$file" ]; then
        echo "INFO:.bash_completion: Sourcing '$file'"
        source_if_exists "$file"
    fi
done
unset file

unset BASH_COMPLETION_FOLDER

echo "INFO:.bash_completion: Done!"
